{% extends "base.html" %}

{% block content %}
<div class="main-header">
    <img src="https://i.postimg.cc/Pq1HGqZK/459c85fcaa5d9f0762479bf382225ac6.jpg" class="prince-logo">
    <h1>PERMIUM KEY APPROVAL REQUIRED</h1>
    <p>ONE MONTH 500 RS PAID</p>
</div>

<div class="card">
    <h3>ğŸ”‘ Request Access</h3>
    
    <div class="info-card">
        <p><strong>Your Unique Key:</strong> <code>{{ user_key }}</code></p>
        <p><strong>Username:</strong> {{ username }}</p>
    </div>

    <div class="grid grid-2">
        <form method="POST" action="{{ url_for('request_approval') }}">
            <button type="submit" class="btn btn-full">ğŸ“ Request Approval</button>
        </form>
        
        <a href="{{ url_for('admin_panel') }}" class="btn btn-full">ğŸ” Admin Panel</a>
    </div>

    {% if session.get('approval_status') == 'pending' %}
    <div class="info-card">
        <div class="alert alert-warning">
            â³ Approval Pending...
        </div>
        
        <p><strong>Your Key:</strong> <code>{{ user_key }}</code></p>
        
        {% set whatsapp_url = "https://api.whatsapp.com/send?phone=918290090930&text=" + 
            "ğŸ¤– HELLO ASHU SIR PLEASE â¤ï¸\nMy name is " + username + "\nPlease approve my key:\nğŸ”‘ " + user_key | urlencode %}
        
        <div style="text-align: center; margin: 20px 0;">
            <a href="{{ whatsapp_url }}" target="_blank" class="whatsapp-btn">
                ğŸ“± Click Here to Open WhatsApp
            </a>
        </div>
        
        <h4>ğŸ“ Message Preview:</h4>
        <div class="console-output">
            ğŸ¤– HELLO ASHU SIR PLEASE â¤ï¸<br>
            My name is {{ username }}<br>
            Please approve my key:<br>
            ğŸ”‘ {{ user_key }}
        </div>
        
        <div class="grid grid-2" style="margin-top: 20px;">
            <a href="{{ url_for('check_approval_status') }}" class="btn btn-full">ğŸ”„ Check Approval Status</a>
            <a href="{{ url_for('approval_request') }}" class="btn btn-full">ğŸ”™ Back</a>
        </div>
    </div>
    {% endif %}
</div>

<div class="footer">
    Made with â¤ï¸ by ASHU KING | Â© 2025
</div>

<script>
    // Auto-check approval status if pending
    {% if session.get('approval_status') == 'pending' %}
    function checkApproval() {
        fetch('{{ url_for("check_approval_status") }}')
            .then(response => response.json())
            .then(data => {
                if (data.approved) {
                    window.location.reload();
                }
            });
    }
    
    // Check every 10 seconds
    setInterval(checkApproval, 10000);
    {% endif %}
</script>
{% endblock %}
